"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[7517],{7968:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var i=s(4848),t=s(8453);const r={sidebar_position:2},o="API Design",c={id:"how-it-works/api_design",title:"API Design",description:"Overview",source:"@site/content/how-it-works/api_design.md",sourceDirName:"how-it-works",slug:"/how-it-works/api_design",permalink:"/xrx-core/docs/how-it-works/api_design",draft:!1,unlisted:!1,editUrl:"https://github.com/8090-inc/xrx-core/blob/develop/docs/content/how-it-works/api_design.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"System Architecture",permalink:"/xrx-core/docs/how-it-works/system_architecture"},next:{title:"Guardrails",permalink:"/xrx-core/docs/how-it-works/guardrails"}},l={},d=[{value:"Overview",id:"overview",level:2},{value:"Components",id:"components",level:2},{value:"Application",id:"application",level:3},{value:"Front End (Client)",id:"front-end-client",level:4},{value:"Reasoning Agent",id:"reasoning-agent",level:4},{value:"xRx Core",id:"xrx-core",level:3},{value:"Orchestrator",id:"orchestrator",level:4},{value:"TTS (Text-to-Speech)",id:"tts-text-to-speech",level:4},{value:"STT (Speech-to-Text)",id:"stt-speech-to-text",level:4},{value:"React xRx Client Library",id:"react-xrx-client-library",level:4},{value:"Agent Framework",id:"agent-framework",level:4},{value:"Communication Flow",id:"communication-flow",level:2},{value:"1. User Input",id:"1-user-input",level:3},{value:"2. Orchestrator Handling",id:"2-orchestrator-handling",level:3},{value:"3. STT Service",id:"3-stt-service",level:3},{value:"4. Reasoning Agent",id:"4-reasoning-agent",level:3},{value:"5. TTS Service",id:"5-tts-service",level:3},{value:"6. Response to Front End",id:"6-response-to-front-end",level:3},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Example Environment Variables",id:"example-environment-variables",level:3},{value:"Conclusion",id:"conclusion",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"api-design",children:"API Design"}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"This document describes the communication flow between various components in the system, including the front end, orchestrator, reasoning agent, TTS (Text-to-Speech), and STT (Speech-to-Text) services. The orchestrator is the central component that manages WebSocket connections and coordinates communication between the front end, STT, TTS, and reasoning agent services. All of these communication flows can be visualized by the sequence diagram below."}),"\n",(0,i.jsx)(n.mermaid,{value:"\nsequenceDiagram\n    participant Client\n    participant Orchestrator\n    participant STT\n    participant Agent\n    participant TTS\n\n    Client->> Orchestrator: Send audio on websockets port 8000\n    Orchestrator->>STT: Send audio on websockets port 8001\n    STT ->>Orchestrator: Return text\n    Orchestrator->>Agent: Send text on port 8003\n    Agent->>Orchestrator: Return text\n    Orchestrator->>TTS: Send text on port 8002\n    TTS ->>Orchestrator: Return audio\n    Orchestrator->>Client: Return audio, text, and application widgets"}),"\n",(0,i.jsx)(n.h2,{id:"components",children:"Components"}),"\n",(0,i.jsx)(n.p,{children:"The xRx system is designed with a modular architecture, separating the core framework from specific applications. This design allows for greater flexibility and customization in application development."}),"\n",(0,i.jsx)(n.h3,{id:"application",children:"Application"}),"\n",(0,i.jsx)(n.p,{children:"The application houses all the application-specific code. This structure ensures efficient development and maintenance of the application functionality."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.h4,{id:"front-end-client",children:"Front End (Client)"}),"\n","The front end is a Next.js client that interacts with the orchestrator via WebSocket connections. It sends user inputs (text or audio) and receives responses (text or audio) from the orchestrator."]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.h4,{id:"reasoning-agent",children:"Reasoning Agent"}),"\n","The reasoning agent processes user inputs and generates appropriate responses. It communicates with the orchestrator via HTTP requests which produce event streaming outputs via POST requests. The server is implemented using FastAPI in Python."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"xrx-core",children:"xRx Core"}),"\n",(0,i.jsx)(n.p,{children:"The xRx Core contains the essential components that form the foundation of the xRx system. These components are designed to be reusable across different applications."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.h4,{id:"orchestrator",children:"Orchestrator"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"[Container]"})," The orchestrator is a Fastify server that manages WebSocket connections with the front end and coordinates communication with the STT, TTS, and reasoning agent services."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.h4,{id:"tts-text-to-speech",children:"TTS (Text-to-Speech)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"[Container]"})," The TTS service converts text responses from the reasoning agent into audio. It communicates with the orchestrator via WebSocket connections. The server is implemented using FastAPI in Python."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.h4,{id:"stt-speech-to-text",children:"STT (Speech-to-Text)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"[Container]"})," The STT service converts audio inputs from the front end into text. It communicates with the orchestrator via WebSocket connections. The server is implemented using FastAPI in Python."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.h4,{id:"react-xrx-client-library",children:"React xRx Client Library"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"[Library]"})," A reusable React library that provides UI components and utilities for building the front-end of xRx-powered applications. It can be imported into each specific app to streamline development."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.h4,{id:"agent-framework",children:"Agent Framework"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"[Library]"})," A reusable library that provides the foundation for building reasoning agents. It includes common functionalities and structures that can be extended and customized for specific application needs."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"These components are either containerized modules (like TTS, STT, Orchestrator) defined as separate Docker containers, or reusable libraries (like react-xrx-client and agent_framework) that can be imported into specific applications. This modular structure allows developers to easily customize and extend xRx for their specific needs while benefiting from a solid, tested foundation."}),"\n",(0,i.jsx)(n.h2,{id:"communication-flow",children:"Communication Flow"}),"\n",(0,i.jsx)(n.p,{children:"The communication flow between the components is designed to ensure seamless interaction and response generation. Below is a detailed breakdown of the communication steps and the data fields involved."}),"\n",(0,i.jsx)(n.h3,{id:"1-user-input",children:"1. User Input"}),"\n",(0,i.jsx)(n.p,{children:"When a user interacts with the front end, they can provide input in two forms: text or audio."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Text Input"}),": The front end sends a text message to the orchestrator via WebSocket.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field"}),": ",(0,i.jsx)(n.code,{children:"content"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"}),": ",(0,i.jsx)(n.code,{children:"string"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": The text message input by the user."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Audio Input"}),": The front end sends an audio message to the orchestrator via WebSocket.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field"}),": ",(0,i.jsx)(n.code,{children:"audio"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"}),": ",(0,i.jsx)(n.code,{children:"Buffer"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": The audio message input by the user."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"2-orchestrator-handling",children:"2. Orchestrator Handling"}),"\n",(0,i.jsx)(n.p,{children:"Upon receiving the user input, the orchestrator processes it based on its type."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Text Input"}),": The orchestrator appends the text message to the chat history and sends it to the reasoning agent."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Audio Input"}),": The orchestrator sends the audio message to the STT service for transcription.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field"}),": ",(0,i.jsx)(n.code,{children:"audio"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"}),": ",(0,i.jsx)(n.code,{children:"Buffer"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": The audio message to be transcribed."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"3-stt-service",children:"3. STT Service"}),"\n",(0,i.jsx)(n.p,{children:"The STT service is responsible for converting audio inputs into text."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The STT service transcribes the audio message into text and sends it back to the orchestrator via WebSocket.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field"}),": ",(0,i.jsx)(n.code,{children:"transcription"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"}),": ",(0,i.jsx)(n.code,{children:"string"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": The text transcription of the audio message."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"4-reasoning-agent",children:"4. Reasoning Agent"}),"\n",(0,i.jsx)(n.p,{children:"The orchestrator then forwards the processed input to the reasoning agent for generating a response."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The orchestrator sends the chat history (including the transcribed text) to the reasoning agent via an HTTP POST request.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Conversational History"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field"}),": ",(0,i.jsx)(n.code,{children:"messages"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"}),": ",(0,i.jsx)(n.code,{children:"ChatMessage[]"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": The chat history including the latest user input."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Session Data"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field"}),": ",(0,i.jsx)(n.code,{children:"session"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"}),": ",(0,i.jsx)(n.code,{children:"{ [key: string]: string }"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": Session-specific data to maintain context."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Action"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field"}),": ",(0,i.jsx)(n.code,{children:"action"})," (Optional)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"}),": ",(0,i.jsx)(n.code,{children:"object"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description"}),': Specific actions to be performed by the agent. These "actions" map to "tools in the agent.']}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["The reasoning agent processes the input and generates a response, which it sends back to the orchestrator.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reasoning Agent Response"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field"}),": ",(0,i.jsx)(n.code,{children:"response"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"}),": ",(0,i.jsx)(n.code,{children:"string"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": The response generated by the reasoning agent."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Updated Session Data"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field"}),": ",(0,i.jsx)(n.code,{children:"session"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"}),": ",(0,i.jsx)(n.code,{children:"{ [key: string]: string }"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": Updated session-specific data. For example (a new cart ID)"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"5-tts-service",children:"5. TTS Service"}),"\n",(0,i.jsx)(n.p,{children:"If the response from the reasoning agent is in text form and needs to be converted to audio, the orchestrator utilizes the TTS service."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The orchestrator sends the text to the TTS service via WebSocket.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field"}),": ",(0,i.jsx)(n.code,{children:"text"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"}),": ",(0,i.jsx)(n.code,{children:"string"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": The text message to be converted to audio."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["The TTS service converts the text to audio and sends it back to the orchestrator via WebSocket.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field"}),": ",(0,i.jsx)(n.code,{children:"audio"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"}),": ",(0,i.jsx)(n.code,{children:"Buffer"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": The audio version of the text message."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"6-response-to-front-end",children:"6. Response to Front End"}),"\n",(0,i.jsx)(n.p,{children:"Finally, the orchestrator sends the response back to the front end, which can be in text or audio form."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Text Response"}),": The orchestrator sends the text response from the reasoning agent to the front end via WebSocket.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field"}),": ",(0,i.jsx)(n.code,{children:"content"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"}),": ",(0,i.jsx)(n.code,{children:"string"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": The text response from the reasoning agent."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Audio Response"}),": The orchestrator sends the audio response from the TTS service to the front end via WebSocket.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field"}),": ",(0,i.jsx)(n.code,{children:"audio"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"}),": ",(0,i.jsx)(n.code,{children:"Buffer"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": The audio response from the TTS service."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,i.jsxs)(n.p,{children:["The orchestrator and other services use environment variables to configure hostnames, ports, and paths for communication. These variables are defined in a ",(0,i.jsx)(n.code,{children:".env"})," file. Each application's ",(0,i.jsx)(n.code,{children:".env"})," file contains all the necessary environment variables for that specific service."]}),"\n",(0,i.jsx)(n.h3,{id:"example-environment-variables",children:"Example Environment Variables"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-env",children:"STT_HOST=xrx-stt\nSTT_PORT=8001\nSTT_PATH=/api/v1/ws\n\nTTS_HOST=xrx-tts\nTTS_PORT=8002\nTTS_PATH=/api/v1/ws\n\nAGENT_HOST=xrx-reasoning\nAGENT_PORT=8003\nAGENT_PATH=/run-reasoning-agent\n"})}),"\n",(0,i.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(n.p,{children:"This document provides an in-depth overview of how the various components in the system communicate with each other, including the specific data fields, their types, and why they are needed. The orchestrator plays a central role in managing WebSocket connections and coordinating communication between the application (frontend and reasoning),  STT, and TTS."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var i=s(6540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);